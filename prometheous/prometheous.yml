# Prometheus Configuration
# This tells Prometheus WHAT to scrape, HOW OFTEN, and WHERE

global:
  # How often to scrape targets by default
  scrape_interval: 15s
  
  # How often to evaluate alerting rules
  evaluation_interval: 15s
  
  # Labels to attach to all time series and alerts
  external_labels:
    monitor: 'vit-inference-monitor'
    environment: 'local'

# Scrape configurations define what Prometheus should monitor
scrape_configs:
  # Job 1: Monitor Prometheus itself (meta-monitoring)
  - job_name: 'prometheus'
    
    # Override global scrape interval for this job
    scrape_interval: 5s
    
    # Static targets - we know Prometheus runs on localhost:9090
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
  
  # Job 2: Monitor our inference service
  - job_name: 'vit-inference'
    
    # Scrape every 10 seconds to catch short-lived metrics
    scrape_interval: 10s
    
    # Timeout for scrape requests
    scrape_timeout: 5s
    
    # Path where metrics are exposed (your service uses /metrics via prometheus_client)
    metrics_path: '/metrics-info'
    
    # CRITICAL: Use container name as hostname
    # Docker Compose provides DNS resolution for service names
    static_configs:
      # - targets: ['host.docker.internal:8801']
      - targets: ['inference-service:8801']
        labels:
          service: 'vit-inference'
          component: 'ml-api'
          
    # Relabeling allows you to modify labels before storing metrics
    metric_relabel_configs:
      # Drop metrics we don't care about (example)
      - source_labels: [__name__]
        regex: 'go_.*'  # Drop Go runtime metrics (if any)
        action: drop

# Optional: Configure remote write to send metrics elsewhere
# remote_write:
#   - url: "https://cloud-monitoring-service.com/api/v1/write"

# Optional: Configure alerting
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']



# prometheus command running

# C:\Projects\ViT>docker run -p 9090:9090 ^
# -v C:/Projects/ViT/vision-transformer-from-scratch/prometheous/prometheous.yml:/etc/prometheus/prometheus.yml ^
# prom/prometheus